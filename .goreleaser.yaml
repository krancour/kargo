version: 2
project_name: kargo
builds:
- id: kargo
  main: ./cmd/cli
  goos:
  # - linux
  - darwin
  # - windows
  goarch:
  - amd64
  - arm64
  ignore:
  - goos: windows
    goarch: arm64
  env:
  - CGO_ENABLED=0
  ldflags:
  - -s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{.Date}}
  no_unique_dist_dir: true
  binary: {{ .ProjectName }}-{{ .Os }}-{{ .Arch }}
archives:
- format: binary
  name_template: {{ .ProjectName }}-{{ .Os }}-{{ .Arch }}
release:
  github:
    owner: krancour
    name: kargo
brews:
- name: Formula/kargo
  description: CLI for Kargo
  # homepage: https://kargo.io
  license: Apache-2.0
  # install: |
  #   src_dir = "src/github.com/krancour/kargo"
  #   (buildpath/src_dir).install buildpath.children
  #   cd src_dir do
  #     ENV["GOPATH"] = buildpath
  #     ENV["VERSION"] = "v#{version}"
  #     ENV["GIT_COMMIT"] = Utils.safe_popen_read("git", "rev-parse", "HEAD").strip
  #     ENV["GIT_TREE_STATE"] = "clean"
  #     system "make", "build-cli"
  #     os = Utils.safe_popen_read("go", "env", "GOOS").strip
  #     arch = Utils.safe_popen_read("go", "env", "GOARCH").strip
  #     bin.install "bin/kargo-#{os}-#{arch}" => "kargo"
  #   end
  # test: |
  #   assert_match "Client Version: v#{version}", shell_output("#{bin}/kargo version --client")
  repository:
    owner: krancour
    name: homebrew-tap
    branch: "{{.ProjectName}}-{{.Version}}"
    pull_request:
      enabled: true
      base:
        branch: main
